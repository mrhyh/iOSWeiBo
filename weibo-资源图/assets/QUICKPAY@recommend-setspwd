{"data":{"children":[{"children":[{"content":"text/html; charset=UTF-8","http-equiv":"Content-Type","tag":"meta"},{"content":"width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, minimal-ui","name":"viewport","tag":"meta"},{"src":"recommend-setspwd.js","tag":"script"},{"children":[{"tag":"text","text":"var is_flybird = navigator.userAgent.toLowerCase().indexOf(\"flybird\")>=0;//### 是否为飞鸟引擎\nvar is_android = navigator.userAgent.toLowerCase().indexOf(\"android\")>=0;//### 是否为android平台\n\nvar path = is_android ? \"com.alipay.android.app/\" : \"AlipaySDK.bundle/\";\n\nvar tipsSet = \"该6位数字密码将用于支付\";\nvar tipsRepeat = \"请再次填写以确认\";\nvar actionSet = \"/recommend/setspwd\";\nvar actionRepeat = \"/recommend/savespwd\";\n\nfunction init() {\n    document.querySelector(\"#tips\").innerText = tipsSet;\n    document.querySelector(\"#arrow_left_png\").src = path + \"arrow_left.png\";\n\tdocument.querySelector(\"#spwd\").focus();\n}\n\n//### 6位数字密码\nfunction onSpwdInput() {\n    resetErrMsg();\n    var el = document.querySelector(\"#spwd\");\n    if(el.value.length == 6) {\n        //TODO 优化:在前端做一些校验\n        onFirstInput();\n    }\n}\n\n//### 初次提交，服务器进行密码的规范性校验\nfunction onFirstInput(){\n    var obj = {\"action\":{\"name\":actionSet}};\n    var svalue = document.querySelector(\"#spwd\").encryptValue;\n\tif(!svalue){\n\t\tsvalue = document.querySelector(\"#spwd\").value;\n\t}\n    var submit_obj = {\"spwd\":svalue};\n    submit_obj[\"encryptType\"] = \"RSA\";\n    obj[\"param\"] = submit_obj;\n    \n    ant.asyncSubmit(obj,function(data){\n        if (data[\"status\"] == \"0001\"){ //校验成功\n            document.querySelector(\"#spwd\").style.display = \"none\";\n            document.querySelector(\"#tips\").innerText = tipsRepeat;\n            document.querySelector(\"#spwdRepeat\").value = \"\";\n            document.querySelector(\"#spwdRepeat\").style.display = \"block\";\n            document.querySelector(\"#spwdRepeat\").focus();\n        }else if (data[\"status\"] == \"0000\"){ //校验失败\n            document.querySelector(\"#spwd\").disabled = false;\n            document.querySelector(\"#spwd\").value = \"\";\n            if (data[\"errMsg\"]){\n                resetErrMsg(data[\"errMsg\"]);\n            }\n            document.querySelector(\"#spwd\").focus();\n        }\n    });\n}\n\n//### 6位密码,第二次确认\nfunction onSpwdRepeatInput() {\n    resetErrMsg();\n    var el = document.querySelector(\"#spwdRepeat\");\n    if(el.value.length == 6) {\n        //提交给服务器进行保存。 Notice:出于安全考虑，这里的JS无法得到密码的实际内容。\n        var obj = {\"action\":{\"name\":actionRepeat}};\n        var svalue = el.encryptValue;\n\t\tif(!svalue){\n\t\t\tsvalue = el.value;\n\t\t}\n\t\tvar submit_obj = {\"spwd\":svalue};\n        submit_obj[\"encryptType\"] = \"RSA\";\n        obj[\"param\"] = submit_obj;\n        ant.asyncSubmit(obj,function(data){\n            if(data[\"status\"] == \"0000\"){//服务器校验失败,再来一次!\n                if (data[\"errMsg\"]){\n                    resetErrMsg(data[\"errMsg\"]);\n                }\n                againOnce();\n            }\n        });\n    }\n}\n\n//### 输入的密码不符合服务器规范,再来一次\nfunction againOnce(){\n    document.querySelector(\"#spwd\").value = \"\";\n    document.querySelector(\"#spwd\").style.display = \"block\";\n    document.querySelector(\"#spwdRepeat\").style.display = \"none\";\n    document.querySelector(\"#tips\").innerText = tipsSet;\n    document.querySelector(\"#spwd\").focus();\n}\n\n//### 打开协议\nfunction openProtocol() {\n    ant.submit({\"action\":{\"name\":\"loc:openweb('\"+protocolURL+\"')\"}});\n}\n\n//### 重置错误消息\nfunction resetErrMsg(errMsg) {\n    if (errMsg == undefined){\n        errMsg = \"\";\n    }\n    if (errMsg.length>0){\n        document.querySelector(\"#errMsg\").innerText = errMsg;\n        document.querySelector(\"#errMsgBox\").style.display = \"block\";\n    } else {\n        document.querySelector(\"#errMsg\").innerText = \"\";\n        document.querySelector(\"#errMsgBox\").style.display = \"none\";\n    }\n}\n\n//### 后退\nfunction onBack(){\n    if (document.querySelector(\"#spwd\").style.display == \"none\"){\n        againOnce();\n    } else {\n        ant.submit({\"action\":{\"name\":\"loc:back\"}});\n    }\n}"}],"tag":"script","type":"text/javascript"},{"href":"AlipaySDK.bundle/common.css","rel":"stylesheet","tag":"link","type":"text/css"},{"tag":"style"}],"tag":"head"},{"children":[{"children":[{"children":[{"id":"arrow_left_png","tag":"img"}],"css":"common_immersion_title_left_box","onclick":"onBack()","tag":"div"},{"children":[{"children":[{"tag":"text","text":"输入支付密码"}],"css":"common_immersion_title_center_text","id":"title","tag":"label"}],"css":"common_immersion_title_center_box","tag":"div"},{"children":[{"id":"help_png","tag":"img"}],"css":"common_immersion_title_right_box","tag":"div"}],"css":"common_immersion_title_box","tag":"div"},{"css":"common_1px_title_line","tag":"div"},{"children":[{"children":[{"css":"pcreditpay_sign_2","id":"tips","tag":"label"}],"css":"common_full_title recommend_setspwd_1","style":"text-align:center;","tag":"div"},{"children":[{"css":"common_spwd","id":"spwd","maxlength":"6","oninput":"onSpwdInput()","tag":"input","type":"payword"},{"css":"common_spwd","id":"spwdRepeat","maxlength":"6","oninput":"onSpwdRepeatInput()","tag":"input","type":"payword"}],"css":"common_spwd_box","id":"spwdBox","tag":"div"},{"children":[{"children":[{"tag":"text","text":"两次密码输入不一致，请重新输入"}],"id":"errMsg","style":"color:#F4333C","tag":"label"}],"id":"errMsgBox","style":"text-align:center;padding-top:15px;display:none;","tag":"div"}],"css":"common_padding_left_right","id":"main_body","style":"-webkit-box-flex:1.0;","tag":"div"}],"css":"common_immersion_body","id":"body","onkeydown":"onBack();","onload":"init()","tag":"body"}],"tag":"html"},"format":"JSON","name":"recommend-setspwd","publishVersion":"150604","tag":"QUICKPAY","time":"0047","tplId":"QUICKPAY@recommend-setspwd","tplVersion":"5.0.0"}