{"data":{"children":[{"children":[{"content":"text/html; charset=UTF-8","http-equiv":"Content-Type","tag":"meta"},{"content":"width=device-width, height=200px, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, minimal-ui","name":"viewport","tag":"meta"},{"src":"cashier-sms.js","tag":"script"},{"children":[{"tag":"text","text":"var is_flybird = navigator.userAgent.toLowerCase().indexOf(\"flybird\")>=0;//### 是否为飞鸟引擎\nvar is_android = navigator.userAgent.toLowerCase().indexOf(\"android\")>=0;//### 是否为android平台\nvar path = is_android ? \"com.alipay.android.app/\" : \"AlipaySDK.bundle/\";\n\nvar nav_back_png = path + \"back.png\";\n//### 倒计时变量\nvar countDownNum = 60;\n\n//### 密码框输入响应\nfunction onPwdInput() {\n\tvar input = document.getElementById('pwd');\n    input.style.cssText=\"color:#000000\";\n\tvar submit = document.getElementById('submit');\t\n\tif (input.value.length > 0) {\n\t\tsubmit.disabled = false;\n\t}\n\telse {\n\t\tsubmit.disabled = true;\t\t\n\t}\n}\n\n//### Android系统自动读取短信帮用户读入\nfunction readSms(){\n    var obj = {\"action\":{\"name\":\"loc:readsms\"}};\n    var submit_obj = {\"smsread\":flybird.rpcData.smsread};\n    obj[\"action\"][\"params\"] = submit_obj;\n    ant.asyncSubmit(obj,function(data){\n        document.getElementById('pwd').innerText = data[\"sms\"];\n    });\n}\n\nfunction init() {\n\t//### 加载图片资源\n\tif(is_android){\n\t\tdocument.getElementById(\"ios_nav\").style.display = \"none\";\n\t\tdocument.getElementById('nav_back_img_android').src = nav_back_png;\n\t} else{\n        if (!is_android) {\n            \n        }\n        else {\n            document.getElementById(\"android_nav\").style.display = \"none\";\n        }\n\n\t\t//### 加载图片资源\n\t\tdocument.getElementById('nav_back_img').src = nav_back_png;\n\t}\n\n\tdocument.getElementById('main_title').innerText = \"请输入手机号\" + flybird.rpcData.mobileMask + \"收到的短信校验码\";\n    \n    //### 支付前置参数\n    if (flybird.rpcData.smstip){\n        document.getElementById(\"main_title\").innerText = flybird.rpcData.smstip;\n    }\n    \n    //### 短信倒计时\n    document.getElementById('resend_btn').disabled = true;\n    countDownNum = 60;\n    countDown();\n    \n    //### Android自动读取短信\n    if (is_android){\n        readSms();\n    }\n\tdocument.getElementById('pwd').focus();\n}\n\n//### 倒计时\nfunction countDown(){\n    var resendBtn = document.getElementById('resend_btn');\n    if (countDownNum > 0){\n        resendBtn.innerText = String(countDownNum) + \"秒后重发\";\n        countDownNum = countDownNum - 1;\n        setTimeout(countDown,1000);\n    } else {\n        resendBtn.innerText = \"重发验证码\";\n        resendBtn.disabled = false;\n    }\n}\n\n//### 重发短信验证码\nfunction submitReSend(){\n    //### 倒计时过程中，不触发提交操作\n    if (countDownNum > 0){\n        return;\n    }\n    \n    var obj = {};\n    obj[\"action\"] = {};\n    obj[\"action\"][\"name\"] = \"/sms/resend\";\n\n    ant.asyncSubmit(obj, function(data) {\n        //### 不管返回啥，用户都要等60秒\n    });\n    \n    document.getElementById('resend_btn').disabled = true;\n    countDownNum = 60;\n    setTimeout(countDown(),1000);\n    document.getElementById('pwd').innerText = \"\";\n}\n\n//### 确认按钮,提交业务数据\nfunction submitInfo() {\n    var obj = {};\n    var submit_obj = {\"smscode\": document.getElementById('pwd').value};\n    \n    if (flybird.rpcData.smsValidateLoginType) {\n        submit_obj[\"smsValidateLoginType\"] = flybird.rpcData.smsValidateLoginType;\n    }\n    \n    obj[\"action\"] = {};\n    obj[\"action\"][\"name\"] = \"/cashier/payment\";\n    //### 支付前置的透传参数\n    obj[\"action\"][\"params\"] = flybird.rpcData.params;\n    \n\tif (flybird.rpcData.nextAction) {\n\t\tobj[\"action\"][\"name\"] = flybird.rpcData.nextAction;\n\t}\n\t\n\tobj[\"param\"] = submit_obj;\n\t\n\tant.asyncSubmit(obj, function(data) {\n        document.getElementById('pwd').style.cssText=\"color:#FF0000\";\n\t\tdocument.getElementById('submit').disabled = false;\n\t});\n    \n    //### 隐藏键盘 输入框\n    document.getElementById('pwd').blur();\n\tdocument.getElementById('submit').disabled = true;\n}\n\n//### 退出\nfunction onBack(){\n    var dialogObj = {\n        title: '',\n        message: '确定要退出吗',\n        okButton: '确定',\n        cancelButton: '取消'\n    };\n    \n    ant.confirm(dialogObj, function (result) {\n        if (result.ok) {\n        \tdocument.getElementById('pwd').blur();\n            ant.submit({\"action\":{\"name\":\"loc:exit\"}});\n        }\n    });\n}"}],"tag":"script"},{"href":"AlipaySDK.bundle/common.css","rel":"stylesheet","tag":"link","type":"text/css"},{"href":"com.alipay.android.app/common.css","rel":"stylesheet","tag":"link","type":"text/css"},{"tag":"style"}],"tag":"head"},{"children":[{"children":[{"children":[{"children":[{"css":"common_nav_left_img","id":"nav_back_img","tag":"img"},{"children":[{"tag":"text","text":"返回"}],"css":"common_nav_left_text","tag":"p"}],"css":"common_nav_left_box","id":"nav_back","onclick":"onBack()","tag":"div"},{"children":[{"children":[{"tag":"text","text":"短信校验码"}],"css":"common_nav_center_text","tag":"label"}],"css":"common_nav_center_box","tag":"div"},{"css":"common_nav_right_box","tag":"div"}],"css":"common_nav_box","id":"ios_nav","tag":"div"},{"children":[{"children":[{"children":[{"css":"common_nav_left_img_android","id":"nav_back_img_android","tag":"img"}],"css":"common_nav_back_box_android","onclick":"onBack()","tag":"div"},{"css":"common_nav_line_android","tag":"div"},{"children":[{"tag":"text","text":"短信校验码"}],"css":"common_nav_center_text common_p_reset","tag":"label"}],"css":"common_nav_title_android","id":"nav_back","tag":"div"},{"css":"common_nav_right_box","tag":"div"}],"css":"common_nav_box_android","id":"android_nav","tag":"div"}],"tag":"nav"},{"children":[{"css":"common_full_bottom_text","id":"main_title","tag":"label"}],"css":"common_padding_left_right common_full_title","id":"common_full_title","tag":"div"},{"children":[{"css":"common_1px_line","tag":"div"},{"children":[{"children":[{"children":[{"tag":"text","text":"校验码"}],"css":"common_cell_left_box_text","tag":"label"}],"css":"common_cell_left_box","tag":"div"},{"children":[{"autofocus":"true","css":"common_cell_input","id":"pwd","oninput":"onPwdInput()","placeholder":"短信校验码","tag":"input","type":"num"}],"css":"common_cell_center_box","style":"padding-right:3px;","tag":"div"},{"css":"common_cell_vert_line","tag":"div"},{"children":[{"children":[{"tag":"text","text":"重发校验码"}],"css":"common_cell_text_size common_cell_input common_theme_text_color common_button_no_bg","disabled":"disabled","id":"resend_btn","onclick":"submitReSend()","style":"width:100%;height:100%","tag":"button"}],"style":"width:103px; height:100%;","tag":"div"}],"css":"common_cell common_padding_left_right","style":"padding-right:0px;","tag":"div"},{"css":"common_1px_line","tag":"div"},{"css":"common_cell_footer_empty_box","tag":"div"},{"children":[{"children":[{"tag":"text","text":"下一步"}],"css":"common_button_main","disabled":"true","id":"submit","onclick":"submitInfo()","tag":"button"}],"css":"common_padding_left_right","tag":"div"}],"css":"common_full_main","id":"main_body","tag":"div"}],"css":"common_full_body","id":"body","onkeydown":"onBack();","onload":"init()","tag":"body"}],"tag":"html"},"format":"JSON","name":"cashier-sms","publishVersion":"150604","tag":"QUICKPAY","time":"0061","tplId":"QUICKPAY@cashier-sms","tplVersion":"5.0.0"}