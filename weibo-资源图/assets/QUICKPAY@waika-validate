{"data":{"children":[{"children":[{"content":"text/html; charset=UTF-8","http-equiv":"Content-Type","tag":"meta"},{"content":"width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, minimal-ui","name":"viewport","tag":"meta"},{"src":"waika-validate.js","tag":"script"},{"children":[{"tag":"text","text":"var is_flybird = navigator.userAgent.toLowerCase().indexOf(\"flybird\")>=0;//### 是否为飞鸟引擎\nvar is_android = navigator.userAgent.toLowerCase().indexOf(\"android\")>=0;//### 是否为android平台\nvar path = is_android ? \"com.alipay.android.app/\" : \"AlipaySDK.bundle/\";\nvar arrow_left_png = path + \"close.png\";\n\nvar loading_blue_gif = path + \"loading_blue.gif\";\nvar success_blue_norepeat_gif = path + \"success_blue_norepeat.gif\";\n\nvar p_array = new Array();\nvar dot_array = new Array();\nvar validate = \"\";\nvar cvv2 = \"\";\n\nfunction init() {\n    document.querySelector(\"#arrow_left_png\").src = arrow_left_png;\n    document.getElementById('date_input').focus();\n    \n    p_array = document.querySelectorAll(\"p\");\n    dot_array = document.querySelectorAll(\".cvv_item\");\n}\n\n//### 支付成功\nfunction onpay_success()\n{\n\tif(is_android){\n\t    document.getElementById('pwd_load_gif').showPaySuccess();    \t\n\t} else {\n    \tdocument.getElementById('pwd_load_gif').src = \"\";\n\t}\n    document.getElementById('pwd_load_text').innerText = '付款成功';\n}\n\n\n//### 提交\nfunction submit(){\n    var obj = {\"action\":{\n        \"name\":\"/cashier/cardValidate\",\n        \"host\":flybird.rpcData.pci_url,\n        \"https\":true,\n        \"neec\" : \"6004\",\n        \"loadtxt\" : \"\",\n        \"enctype\": \"application/x-www-form-urlencoded\",\n        \"request_param\":\"requestData\"\n    }};\n    var submit_obj = {\"validate\":validate};\n    submit_obj[\"cvv2\"] = cvv2;\n    obj[\"param\"] = submit_obj;\n    \n    ant.asyncSubmit(obj, function(data) {\n        //### 支付成功\n        if (data[\"status\"] == \"0001\") {\n            onpay_success();\n        }\n        //### 信息输入错误\n        else if (data[\"status\"] == \"0000\") {\n        \tdocument.getElementById('date_input').value = \"\";\n        \tdocument.getElementById('date_input').focus();\n            if(is_android){\n\t\t\t    document.getElementById('pwd_load_gif').pauseProgressWheel();    \t\n        \t} else {\n\t        \tdocument.getElementById('pwd_load_gif').src = \"\";\n        \t}\n    \t\tdocument.getElementById('pwd_load').style.display = \"none\";\n    \t\tonDateInput();\n        }\n    });\n    \n    document.getElementById('date_input').blur();\n    if(is_android){\n\t    document.getElementById('pwd_load_gif').showProgressWheel();    \t\n\t} else {\n    \tdocument.getElementById('pwd_load_gif').src = loading_blue_gif;;\n\t}\n    document.getElementById('pwd_load').style.display = \"-webkit-box\";\n}\n\n//### 返回\nfunction onBack() {\n    ant.confirm({\n     \t\ttitle: '',\n            message: '确定要放弃付款？',\n     \t\tokButton: '确定',\n     \t\tcancelButton: '取消'\n\t\t\t}, function (result) {\n     \t\t\n     \t\tif (result.ok) {\n     \t\t\tant.submit({\"action\":{\"name\":\"loc:exit\"}});\n     \t\t}\n\t});\n}\n\nfunction requestFocus(){\n\t\n\tdocument.getElementById(\"date_input\").focus();\n}\n\nfunction onDateInput() {\n\tvar input = document.getElementById('date_input');\n\tvar text = input.value;\n\t\n\tfor (var i = 0; i <  4; i++) {\n\t\tp_array[i].innerText = \"\";\n\t}\n\t\n    validate = \"\";\n\tfor (var i = 0; i < text.length && i < 4; i++) {\n\t\tp_array[i].innerText = text.substr(i, 1);\n        validate = validate + text.substr(i, 1);\n\t}\n    \n    for (var i = 0; i <  3; i++) {\n        dot_array[i].style.display = \"none\";\n    }\n    \n    cvv2 = \"\";\n    for (var i = 4; i < text.length && i < 7; i++) {\n        dot_array[i-4].style.display = \"block\";\n        cvv2 = cvv2 + text.substr(i, 1);\n    }\n\t\n\tif (text.length >= 7) {\n\t\tinput.value = text.substr(0, 7);\n        submit();\n\t}\n}"}],"tag":"script"},{"href":"AlipaySDK.bundle/common.css","rel":"stylesheet","tag":"link","type":"text/css"},{"href":"com.alipay.android.app/common.css","rel":"stylesheet","tag":"link","type":"text/css"},{"tag":"style"}],"tag":"head"},{"children":[{"children":[{"children":[{"id":"arrow_left_png","tag":"img"}],"css":"common_immersion_title_left_box","onclick":"onBack()","tag":"div"},{"children":[{"children":[{"tag":"text","text":"确认付款"}],"css":"common_immersion_title_center_text","id":"title","tag":"label"}],"css":"common_immersion_title_center_box","tag":"div"},{"css":"common_immersion_title_right_box","tag":"div"}],"css":"common_immersion_title_box","tag":"div"},{"css":"common_1px_title_line","tag":"div"},{"children":[{"children":[{"children":[{"children":[{"tag":"text","text":"有效期"}],"css":"pcreditpay_sign_2","tag":"label"},{"children":[{"tag":"text","text":"MM/YY"}],"css":"pcreditpay_sign_2","style":"padding-left:10px;","tag":"label"}],"css":"recommend_setspwd_1","tag":"div"},{"children":[{"children":[{"css":"num_item_2","id":"p0","tag":"p"},{"css":"num_line","tag":"div"},{"css":"num_item_2","id":"p1","tag":"p"},{"css":"num_line","tag":"div"},{"css":"num_item_2","id":"p2","tag":"p"},{"css":"num_line","tag":"div"},{"css":"num_item_2","id":"p3","tag":"p"}],"css":"common_box_flex num_box_2","style":"","tag":"div"}],"css":"common_box_flex","id":"validate","onclick":"requestFocus();","style":"","tag":"div"}],"tag":"div"},{"style":"-webkit-box-flex:1.0;","tag":"div"},{"children":[{"children":[{"children":[{"tag":"text","text":"安全码"}],"css":"pcreditpay_sign_2","tag":"label"},{"children":[{"tag":"text","text":"CVV"}],"css":"pcreditpay_sign_2","style":"padding-left:10px;","tag":"label"}],"css":"recommend_setspwd_1","tag":"div"},{"children":[{"children":[{"children":[{"css":"cvv_item","tag":"div"}],"css":"cvv_box common_box_flex","tag":"div"},{"css":"num_line","tag":"div"},{"children":[{"css":"cvv_item","tag":"div"}],"css":"cvv_box common_box_flex","tag":"div"},{"css":"num_line","tag":"div"},{"children":[{"css":"cvv_item","tag":"div"}],"css":"cvv_box common_box_flex","tag":"div"}],"css":"common_box_flex num_box_cvv","tag":"div"}],"css":"common_box_flex","id":"cvv","onclick":"requestFocus();","style":"","tag":"div"}],"tag":"div"}],"css":"common_padding_left_right","style":"display:-webkit-box;","tag":"div"},{"id":"date_input","keyboard":"safe","oninput":"onDateInput()","style":"width:0px; height:0px;","tag":"input","type":"num"},{},{"children":[{"css":"progresswheel","id":"pwd_load_gif","style":"width:55px; height:55px;","tag":"img"},{"children":[{"children":[{"tag":"text","text":"正在付款..."}],"id":"pwd_load_text","style":"font-size:15px; color:#000000;","tag":"label"}],"style":"text-align:center; padding-top:20px;","tag":"div"}],"id":"pwd_load","style":"display:none; -webkit-box-align:center; -webkit-box-orient:vertical; -webkit-box-pack:center; -webkit-box-flex:1.0;","tag":"div"}],"css":"common_immersion_body","id":"body","onkeydown":"onBack();","onload":"init()","tag":"body"}],"tag":"html"},"format":"JSON","name":"waika-validate","publishVersion":"150604","tag":"QUICKPAY","time":"0036","tplId":"QUICKPAY@waika-validate","tplVersion":"5.0.0"}