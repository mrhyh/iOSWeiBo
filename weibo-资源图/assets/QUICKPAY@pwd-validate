{"data":{"children":[{"children":[{"content":"text/html; charset=UTF-8","http-equiv":"Content-Type","tag":"meta"},{"content":"width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, minimal-ui","name":"viewport","tag":"meta"},{"src":"pwd-validate.js","tag":"script"},{},{"children":[{"tag":"text","text":"var is_flybird = navigator.userAgent.toLowerCase().indexOf(\"flybird\")>=0;//### 是否为飞鸟引擎\nvar is_android = navigator.userAgent.toLowerCase().indexOf(\"android\")>=0;//### 是否为android平台\nvar is_ios = !is_android;\nvar path = is_android ? \"com.alipay.android.app/\" : \"AlipaySDK.bundle/\";\nvar nav_back_png = path + \"back.png\";\nvar pageType = \"openService\";\nvar fingerRetryMaxNum = 3;\nvar passwordBox,spasswordBox;\n\nvar thirdPay  = flybird.rpcData.fingerPay;  //### 第三方支付，默认先检查指纹，与手环互斥.服务端只会下发一个.\nif (thirdPay == undefined) {\n    thirdPay = flybird.rpcData.braceletPay;\n}\n\nfunction init() {\n    var passwordBox = document.querySelector(\"#password\");\n    var spasswordBox = document.querySelector(\"#spassword\");\n    \n    if(is_android){\n\t\tdocument.getElementById(\"ios_nav\").style.display = \"none\";\n\t\tdocument.getElementById('nav_back_img_android').src = nav_back_png;\n\t} else{\n        if (!is_android) {\n            \n        }\n        else {\n            document.getElementById(\"android_nav\").style.display = \"none\";\n        }\n\n\t\t//### 加载图片资源\n\t\tdocument.getElementById('nav_back_img').src = nav_back_png;\n\t}\n    \n    if (flybird.rpcData.pwdValidateType){\n        pageType = flybird.rpcData.pwdValidateType;\n    }\n\n    if (pageType == \"newCard\"){\n        document.querySelector(\"#tipsTop\").innerText = \"添加银行卡\";\n        document.querySelector(\"#tipsBefore\").innerText = \"请输入支付密码，以添加新的银行卡\";\n    } else if (pageType == \"openService\"){\n        document.querySelector(\"#tipsTop\").innerText = \"身份验证\";\n        document.querySelector(\"#tipsBefore\").innerText = \"请输入支付密码，完成身份验证\";\n    }\n    \n    passwordBox.style.display = 'none';\n    spasswordBox.style.display = 'none';\n    document.querySelector(\"#main_body\").style.display = \"none\";\n    //is_android = true;\n    //###开始判断第三方验证\n    checkThridPay();\n}\n\nfunction checkThridPay(){\n    if (thirdPay){\n        var obj = {\"action\":{\"name\":flybird.rpcData.authAction}};\n        submit_obj = {\"nativeValidate\":true};\n        obj[\"param\"] = submit_obj;\n        \n        ant.asyncSubmit(obj, function(data) {\n            //### 第三方认证过程失败，开始调用密码支付\n            if (data[\"status\"] == \"0004\" || data[\"status\"] == \"0005\") {\n                thirdPay = false;\n                openPwd();\n            }\n            else if (data[\"status\"] == \"0009\") {\n                        if (flybird.rpcData.backAct == \"exit\") {\n                            ant.submit({\"action\":{\"name\":\"loc:exit\"}});\n                        }\n                        else {\n                            ant.submit({\"action\":{\"name\":\"loc:back\"}});\n                        }\n            }\n        });\n    } else {\n        openPwd();\n    }\n}\n\n//### 打开密码框\nfunction openPwd(){\n    document.getElementById(\"main_body\").style.display = \"inline\";\n    if (flybird.rpcData.spasswordPay){\n        document.querySelector(\"#spassword\").style.display = \"-webkit-box\";\n        document.querySelector(\"#password\").style.display = \"none\";\n        document.querySelector(\"#payBtn\").style.display = \"none\";\n\t\tdocument.querySelector(\"#spwd\").focus();\n    } else {\n        document.querySelector(\"#spassword\").style.display = \"none\";\n        document.querySelector(\"#password\").style.display = \"-webkit-box\";\n\t\tdocument.querySelector(\"#pwd\").focus();\n    }\n}\n\n//### 简单6位密码框输入响应\nfunction onSpwdInput() {\n    var spwd = document.querySelector(\"#spwd\");\n    if (spwd.value.length >= 6) {\n        var svalue = spwd.encryptValue;\n\t\tif(!svalue){\n\t\t\tsvalue = spwd.value;\n\t\t}\n\t\tvar submit_obj = {\"spwd\":svalue};\n        submit_obj[\"encryptType\"] = \"RSA\";\n        \n        var obj = {};\n        obj[\"param\"] = submit_obj;\n        \n        submit_pay(spwd, obj);\n    }\n}\n\n//### 普通密码输入响应\nfunction onPwdInput(){\n    var pwd = document.querySelector(\"#pwd\");\n    if (pwd.value.length > 0){\n        document.querySelector(\"#payBtn\").disabled = false;\n    }else{\n        document.querySelector(\"#payBtn\").disabled = true;\n    }\n}\n\n//### 普通密码输入完，完成付款\nfunction onPasswordPay() {\n    var pwd = document.querySelector(\"#pwd\")\n    if (pwd.value.length > 0) {\n        var submit_obj = {};\n        submit_obj[\"pwd\"] = pwd.value;\n        submit_obj[\"encryptType\"] = \"RSA\";\n        \n        var obj = {};\n        obj[\"param\"] = submit_obj;\n        \n        submit_pay(pwd, obj);\n    }\n}\n\n//### 输入密码后，提交支付\nfunction submit_pay(pwd, obj) {\n    obj[\"action\"] = {};\n    obj[\"action\"][\"name\"] = flybird.rpcData.nextAction;\n    obj[\"action\"][\"params\"] = flybird.rpcData.params;\n    ant.asyncSubmit(obj,function(data){\n        //### 清空密码框\n        pwd.value = \"\";\n        pwd.focus();\n    });\n    pwd.blur();\n}\n\n//### 退出\nfunction onBack() {\n    if (flybird.rpcData.backAct == \"exit\") {\n        var confirmObj = {\n            title: '',\n            message: '确定要退出吗?',\n            okButton: '确定',\n            cancelButton: '取消'\n        };\n        ant.confirm(confirmObj, function (result) {\n            if (result.ok) {\n                ant.submit({\"action\":{\"name\":\"loc:exit\"}});\n            }\n        });\n        return;\n    } else {\n        ant.submit({\"action\":{\"name\":\"loc:back\"}});\n    }\n}"}],"tag":"script"},{"href":"AlipaySDK.bundle/common.css","rel":"stylesheet","tag":"link","type":"text/css"},{"tag":"style"}],"tag":"head"},{"children":[{"children":[{"children":[{"children":[{"css":"common_nav_left_img","id":"nav_back_img","tag":"img"},{"children":[{"tag":"text","text":"返回"}],"css":"common_nav_left_text","tag":"p"}],"css":"common_nav_left_box","id":"nav_back","onclick":"onBack()","tag":"div"},{"children":[{"children":[{"tag":"text","text":"身份验证"}],"css":"common_nav_center_text","id":"tipsTop","tag":"label"}],"css":"common_nav_center_box","tag":"div"},{"css":"common_nav_right_box","tag":"div"}],"css":"common_nav_box","id":"ios_nav","tag":"div"},{"children":[{"children":[{"children":[{"css":"common_nav_left_img_android","id":"nav_back_img_android","tag":"img"}],"css":"common_nav_back_box_android","onclick":"onBack()","tag":"div"},{"css":"common_nav_line_android","tag":"div"},{"children":[{"tag":"text","text":"身份验证"}],"css":"common_nav_center_text common_p_reset","tag":"label"}],"css":"common_nav_title_android","id":"nav_back","tag":"div"},{"css":"common_nav_right_box","tag":"div"}],"css":"common_nav_box_android","id":"android_nav","tag":"div"}],"tag":"nav"},{"children":[{"children":[{"children":[{"tag":"text","text":"请输入支付密码，完成身份验证"}],"css":"common_full_bottom_text","id":"tipsBefore","tag":"label"}],"css":"common_full_title","style":"padding-top:2.5px;text-align:center;","tag":"div"},{"children":[{"children":[{"children":[{"style":"width:15px;","tag":"div"},{"autofocus":"true","id":"pwd","oninput":"onPwdInput()","placeholder":"支付宝支付密码","style":"-webkit-box-flex:1.0; height:100%; font-size:15px; border:0px; padding:0px; color:#000000;","tag":"input","type":"password"}],"css":"common_cell_center_box","tag":"div"}],"css":"common_spwd_box","id":"password","style":"display:-webkit-box; -webkit-box-align:center;","tag":"div"},{"children":[{"autofocus":"true","css":"common_spwd","id":"spwd","oninput":"onSpwdInput()","tag":"input","type":"payword"}],"css":"common_spwd_box","id":"spassword","tag":"div"}],"css":"common_padding_top_bottom","id":"pwdBox","tag":"div"},{"children":[{"tag":"text","text":"下一步"}],"css":"common_button_main","disabled":"disabled","id":"payBtn","onclick":"onPasswordPay()","tag":"button"}],"css":"common_full_main common_padding_left_right","id":"main_body","tag":"div"}],"css":"common_full_body","id":"body","onkeydown":"onBack();","onload":"init()","tag":"body"}],"tag":"html"},"format":"JSON","name":"pwd-validate","publishVersion":"150604","tag":"QUICKPAY","time":"0051","tplId":"QUICKPAY@pwd-validate","tplVersion":"5.0.0"}